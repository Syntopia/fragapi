Camera2D=function(){this.mouseDownX=0,this.mouseX=0,this.mouseDownY=0,this.mouseY=0,this.centerX=0,this.centerY=0,this.zoomFactor=1.5,this.zoom=1,this.dragFactor=2,this.dragging=!1,this.dirty=!1,this.keyUp=!1,this.keyDown=!1,this.keyLeft=!1,this.keyRight=!1,this.keyW=!1,this.keyS=!1},Camera2D.prototype={constructor:Camera2D,init:function(t){this.addListeners(t)},setCenter:function(t,e){this.centerX=t,this.centerY=e},setZoom:function(t){this.zoom=t},mouseDown:function(t){var e=this.canvas.getBoundingClientRect();this.mouseDownX=t.clientX-e.left,this.mouseDownY=t.clientY-e.top,this.dragging=!0,this.dirty=!0},stopDragging:function(){this.dragging&&(this.centerX-=(this.mouseX-this.mouseDownX)*this.zoom*this.dragFactor,this.centerY+=(this.mouseY-this.mouseDownY)*this.zoom*this.dragFactor),this.dragging=!1,this.dirty=!0},mouseUp:function(t){this.stopDragging()},mouseWheel:function(t){t.detail<0&&this.doZoom(this.zoomFactor),t.detail>0&&this.doZoom(1/this.zoomFactor),t.wheelDelta<0&&this.doZoom(this.zoomFactor),t.wheelDelta>0&&this.doZoom(1/this.zoomFactor),t.preventDefault&&t.preventDefault(),t.returnValue=!1,this.dirty=!0},mouseMove:function(t){var e=this.canvas.getBoundingClientRect();this.mouseX=t.clientX-e.left,this.mouseY=t.clientY-e.top,this.dirty=this.dirty||this.dragging,console.log("[centerX: "+this.centerX+" centerY: "+this.centerY+" zoom: "+this.zoom+"]")},toggleStatus:function(t,e,i){switch(t){case 38:this.keyUp=e;break;case 40:this.keyDown=e;break;case 37:this.keyLeft=e;break;case 39:this.keyRight=e;break;case 87:this.keyW=e;break;case 83:this.keyS=e;break;default:return}i.preventDefault&&i.preventDefault(),i.returnValue=!1},getViewWidth:function(){return this.canvas.getBoundingClientRect().width},getViewHeight:function(){return this.canvas.getBoundingClientRect().height},doZoom:function(t){dx=this.mouseX-this.getViewWidth()/2,dy=this.getViewHeight()/2-this.mouseY,this.centerX+=2*dx*this.zoom*(1-t),this.centerY+=2*dy*this.zoom*(1-t),this.zoom*=t},checkKeys:function(){(this.keyDown||this.keyUp||this.keyLeft||this.keyRight||this.keyW||this.keyS)&&(this.dirty=!0),this.keyW&&this.doZoom(this.zoomFactor),this.keyS&&this.doZoom(1/this.zoomFactor),this.keyDown&&(this.centerY+=10),this.keyUp&&(this.centerY-=10),this.keyLeft&&(this.centerX+=10),this.keyRight&&(this.centerX-=10)},setUniforms:function(t){var e=t.getWidth(),i=t.getHeight(),r=this.centerX/e,n=this.centerY/i;this.dragging&&(r=(this.centerX-(this.mouseX-this.mouseDownX)*this.zoom*this.dragFactor)/e,n=(this.centerY+(this.mouseY-this.mouseDownY)*this.zoom*this.dragFactor)/i),t.setUniform2f("center",r,n),t.setUniform1f("zoom",this.zoom)},addListeners:function(t){this.canvas=document.getElementById(t);var e=this;this.canvas.addEventListener("mousedown",function(t){e.mouseDown(t)},!1),this.canvas.addEventListener("mouseup",function(t){e.mouseUp(t)},!1),this.canvas.addEventListener("mouseout",function(t){e.mouseUp(t)},!1),this.canvas.addEventListener("mousemove",function(t){e.mouseMove(t)},!1),this.canvas.addEventListener("mousewheel",function(t){e.mouseWheel(t)},!1),this.canvas.addEventListener("DOMMouseScroll",function(t){e.mouseWheel(t)},!1),document.addEventListener("keydown",function(t){e.toggleStatus(t.keyCode,!0,t)},!1),document.addEventListener("keyup",function(t){e.toggleStatus(t.keyCode,!1,t)},!1)}},Camera2D.vertexShader="attribute vec3 position;\nvarying vec2 pos;\nvarying vec2 canvasPos;\nuniform float zoom;\nuniform vec2 center;\n\nvoid main() {\n	pos = position.xy * zoom + center;\n	canvasPos = position.xy;\n	gl_Position =  vec4(position, 1.0);\n}\n";var fragapi={REVISION:"0.0.0"};window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t,e){return window.setTimeout(t,1e3/60)}}(),window.console||(window.console={}),window.console.log||(window.console.log=function(){}),fragapi.getGlFromCanvas=function(t){var e,i=document.getElementById(t);try{var r={antialias:!1,depth:!1,alpha:!1};e=i.getContext("experimental-webgl",r),null==e&&(e=i.getContext("webgl",r))}catch(n){}return e||alert("Could not initialise WebGL."),e.viewportWidth=i.width,e.viewportHeight=i.height,e},fragapi.pendingOperations=[],fragapi.externalShaders=new Map,fragapi.pendingOperationsCounter=0,fragapi.loadScript=function(t,e,i){var r=document.getElementsByTagName("head")[0],n=document.createElement("script");n.type="text/javascript",n.onload=i,n.src=t,r.appendChild(n),fragapi.pendingOperations.push(t)},fragapi.injectShader=function(){1!=fragapi.pendingOperations.length&&console.error("Expected one pending operation");var t=fragapi.pendingOperations.pop();console.log("Retrieved shader: "+t+" %o",fragapi._externalShader.split("\n").join().substring(0,150)),fragapi.externalShaders.set(t,fragapi._externalShader)},fragapi.getShader=function(t,e,i){return shader=t.createShader(i),t.shaderSource(shader,e),t.compileShader(shader),t.getShaderParameter(shader,t.COMPILE_STATUS)?shader:(console.log(e),console.log(t.getShaderInfoLog(shader)),alert(t.getShaderInfoLog(shader)),null)},fragapi.getShaderFromElement=function(t,e){var i=document.getElementById(e);if(!i)return null;for(var r="",n=i.firstChild;n;)n.nodeType==n.TEXT_NODE&&(r+=n.textContent),n=n.nextSibling;return fragapi.getShader(t,r,i.type)},FrameBuffer=function(){this.name="Undefined",this.fragmentShader="",this.vertexShader=""},FrameBuffer.create3D=function(t){var e=new FrameBuffer;return e.fragmentShader=t,e},FrameBuffer.create=function(t,e){var i=new FrameBuffer;return i.fragmentShader=t,i.vertexShader=e,i},FrameBuffer.create2D=function(t){var e=new FrameBuffer;e.fragmentShader=t,e.vertexShaderSource=Camera2D.vertexShader;var i=new Camera2D;return e.camera=i,e},FrameBuffer.prototype={constructor:FrameBuffer,getName:function(){return this.name},setName:function(t){this.name=t},setGl:function(t){this.gl=t},printDebug:function(){console.log(this.toString())},toString:function(){return"FrameBuffer["+this.name+", fragmentShader='"+this.fragmentShader+"', vertexShader = '"+this.vertexShader+"']"},setUniform1f:function(t,e){this.gl.uniform1f(this.getUniformLocation(t),e)},setUniform2f:function(t,e,i){this.gl.uniform2f(this.getUniformLocation(t),e,i)},setUniform3f:function(t,e,i,r){this.gl.uniform3f(this.getUniformLocation(t),e,i,r)},getFromElement:function(t){var e=document.getElementById(t);if(!e)return null;for(var i="",r=e.firstChild;r;)r.nodeType==r.TEXT_NODE&&(i+=r.textContent),r=r.nextSibling;return i},resolve:function(t,e){if(fragapi.externalShaders.has(t))return console.log("Found "+t+" in cache"),fragapi.externalShaders.get(t);var i=this.getFromElement(t);if(null!=i)return console.log("Resolved "+t+" from element"),i;if(!(fragapi.pendingOperations.length>0)){var r=this;fragapi.loadScript(t,t,function(){r.initShaders()})}},initShaders:function(){if(fragapi.pendingOperationsCounter>10)return void console.log("I/O timed out:  %O",fragapi.pendingOperations);if(null==this.vertexShaderSource&&0==fragapi.pendingOperations.length&&(this.vertexShaderSource=this.resolve(this.vertexShader)),null==this.fragmentShaderSource&&0==fragapi.pendingOperations.length&&(this.fragmentShaderSource=this.resolve(this.fragmentShader)),fragapi.pendingOperations.length>0){console.log("Pending I/O operations: %O",fragapi.pendingOperations.join());var t=this;return fragapi.pendingOperationsCounter++,void window.setTimeout(function(){t.initShaders()},300)}var e=fragapi.getShader(this.gl,this.vertexShaderSource,this.gl.VERTEX_SHADER),i=fragapi.getShader(this.gl,this.fragmentShaderSource,this.gl.FRAGMENT_SHADER);this.shaderProgram=this.gl.createProgram(),this.gl.attachShader(this.shaderProgram,e),this.gl.attachShader(this.shaderProgram,i),this.gl.linkProgram(this.shaderProgram),this.gl.getProgramParameter(this.shaderProgram,this.gl.LINK_STATUS)||alert("Could not initialise shaders"),this.gl.useProgram(this.shaderProgram),this.shaderProgram.vertexPositionAttribute=this.gl.getAttribLocation(this.shaderProgram,"position"),this.gl.enableVertexAttribArray(this.shaderProgram.vertexPositionAttribute),this.gl.getExtension("WEBGL_debug_shaders"),this.start()},initBuffers:function(){var t=this.gl;this.squareVertexPositionBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.squareVertexPositionBuffer);var e=[1,1,0,-1,1,0,1,-1,0,-1,-1,0];t.bufferData(t.ARRAY_BUFFER,new Float32Array(e),t.STATIC_DRAW),this.squareVertexPositionBuffer.itemSize=3,this.squareVertexPositionBuffer.numItems=4},init:function(){this.initBuffers(),this.initShaders()},draw:function(){this.counter++,this.counter>1e3&&(this.animate=function(){},this.draw=function(){},console.log("Killing")),console.log("Drawing frame");{var t=this.gl;.5*t.viewportWidth,.5*t.viewportHeight}t.viewport(0,0,t.viewportWidth,t.viewportHeight),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),t.bindBuffer(t.ARRAY_BUFFER,this.squareVertexPositionBuffer),t.vertexAttribPointer(this.shaderProgram.vertexPositionAttribute,this.squareVertexPositionBuffer.itemSize,t.FLOAT,!1,0,0),t.drawArrays(t.TRIANGLE_STRIP,0,this.squareVertexPositionBuffer.numItems)},updateUniforms:function(){console.log("Update uniforms - base")},getUniformLocation:function(t){var e=this.gl.getUniformLocation(this.shaderProgram,t);return e},animate:function(){this.camera&&(this.camera.checkKeys(),(this.camera.dirty||this.dirty)&&(this.camera.setUniforms(this),this.camera.dirty=!1,this.dirty=!0)),this.dirty&&(this.updateUniforms(),this.dirty=!1,this.draw());var t=this;requestAnimFrame(function(){t.animate()})},setDirty:function(){this.dirty=!0},start:function(){this.counter=0,this.dirty=!0,this.animate()},renderToCanvas:function(t){this.gl=fragapi.getGlFromCanvas(t),this.camera&&this.camera.init(t),this.init()},getWidth:function(){return this.gl.viewportWidth},getHeight:function(){return this.gl.viewportHeight}};
//# sourceMappingURL=fragapi-dev.min.js.map